<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>hit board</title>
	<link href="css/hit_board/jquery.gridly.css" rel="stylesheet" type="text/css" />
	<style type="text/css">
	div {
		display: inline-block;
		border-style: solid;
		border-width: 1px;
		width: 20px;
		height: 20px;
	}
	</style>
</head>
<body>
<table id="board" border="1" width="90px" height="90px">
	<tr val="0">
		<td val="0"></td><td val="1"></td><td val="2"></td>
	</tr>
	<tr val="1">
		<td val="0"></td><td val="1"></td><td val="2"></td>
	</tr>
	<tr val="2">
		<td val="0"></td><td val="1"></td><td val="2"></td>
	</tr>	
</table>
<br />
<div id="ji">1</div>
<div>2</div>
<div>3</div>
<br />
<span></span>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"> </script>
<script src="js/hit_board/draggabilly.pkgd.min.js" type="text/javascript"> </script>
<script type="text/javascript" >

	/*$('td').hover(function() {
		$(this).css('background-color', '#f00');
    }, function() {
		$(this).css('background-color', '#fff');
    });*/

	var divs = document.getElementsByTagName('div');
	
	/*
	* 取得td位置, 大小
	*/
	var cols = function() {
		var cols = $('td');
		var tmp = [];
		for(var i=0; i<cols.length; i++) {
			_top = $(cols[i]).offset().top;
			_left = $(cols[i]).offset().left;
			_height = $(cols[i]).height();
			_width = $(cols[i]).width();
			tmp[i] = {"top":_top, "left":_left, "height":_height, "width":_width};
		}
		return tmp;
	};
	
	var cols = cols();

	
	for(var i=0; i<divs.length; i++) {
		draggie = new Draggabilly(divs[i]);
		
		draggie.on('dragStart', function(draggieInstance, event, pointer) {
			console.log(this.element.innerHTML);
		});

		draggie.on('dragMove', function(draggieInstance, event, pointer) {
			var result = exec(event.x, event.y);
			 console.log(result);
			if(result.status) {
				console.log('-');
				$('#board').find('tr[val='+result.x+']').find('td[val='+result.y+']').css('background-color', '#f00');
				$(this).hide();
			} else {
			console.log('--');
				$('#board').find('td').css('background-color', '#fff');
			}
			
			function exec(x, y) {
				var pos = [
					{"x":0, "y":0}, {"x":1, "y":0}, {"x":2, "y":0}, 
					{"x":0, "y":1}, {"x":1, "y":1}, {"x":2, "y":1}, 
					{"x":0, "y":2}, {"x":1, "y":2}, {"x":2, "y":2}];
					console.log(pos);
				for(var i=0; i<cols.length; i++) {
					if(x>=cols[i].top && x<=(cols[i].top+cols[i].height)) {
						if(y>=cols[i].left && y<=(cols[i].left+cols[i].width)) {
						console.log(i);
							return {"status":true, "x":pos[i].x, "y":pos[i].y};
						}
					}
				}
				return {"status":false};
			}

		});
		
		draggie.on('dragEnd', function(draggieInstance, event, pointer) {
			//
		});
	}
	
	/*
	function hit_board() {
		
		this.monster = [
			{"name":"a", "hp":"5", "position":"00000000"},
			{"name":"b", "hp":"5", "position":"00000000"}
		];
		
		this.init = function() {
		
			console.log(this.monster);
			
			var board = document.getElementsByTagName('td');
			for(var i=0; i<board.length; i++) {
				board[i].onclick = function() {
					
					var row = this.parentNode.getAttribute("val");
					var col = this.getAttribute("val");
				
					console.log(row+'-'+col);
				}
			}
			
			var monster = document.getElementsByTagName('div');
			for(var i=0; i<monster.length; i++) {
				monster[i].onmousedown = function(e) {
					this.style.position = "absolute";
					this.style.top = e.x + 'px';
					this.style.left = e.y + 'px';
					console.log(e.x +'-'+ e.y + '/' + this.x + '-' + this.y);
				}

			}
							document.onmousemove = function(e){
					document.getElementsByTagName('span')[0].innerHTML = e.x + ',' + e.y;
				}
			
		}
		
		this.say = function() {
			alert('idis');
		}
	}
	
	var board = new hit_board();
	board.init();*/
	
</script>
</body>
</html>

